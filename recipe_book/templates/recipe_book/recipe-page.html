{% extends "base.html" %}
{% load static %}

{% block token %}
<meta name="csrf-token" content="{{ csrf_token }}">
{% endblock token %}

{% block content %}
<div class="container-xl g-0">
    <div class="m-3 my-md-4 m-lg-4 p-4 bg-white recipe-container">
        <div class="row">
            <div class="img-container d-flex col-md-7">
                {% if "placeholder" in recipe.feature_image.url %}
                <img class="img-cover" src="{% static 'images/default-image.webp' %}" alt="placeholder image">
                {% else %}
                <img class="img-cover" src="{{ recipe.feature_image.url }}" alt="{{ recipe.alt_text }}">
                {% endif %}
            </div>
            <div class="col-md-5 mt-2 mt-md-0 d-flex flex-column">
                <div class="row d-flex justify-content-between">
                    <div class="col-auto fs-rem-150">X X X X X (123)</div>
                    <div class="col-auto fs-rem-150 brand-brown">
                        {% if recipe.category == 1 %}
                        <i class="fa-solid fa-drumstick-bite"></i>
                        {% elif recipe.category == 2 %}
                        <i class="fa-solid fa-bacon"></i>
                        {% elif recipe.category == 3 %}
                        <i class="fa-solid fa-cow"></i>
                        {% elif recipe.category == 4 %}
                        <i class="fa-solid fa-fish"></i>
                        {% elif recipe.category == 5 %}
                        <i class="fa-brands fa-pagelines"></i>
                        {% endif %}
                    </div>
                </div>
                <h1 class="fs-rem-130 fs-rem-lg-180 mt-2">{{ recipe.title }}</h1>
                <div class="bg-brand-green h-line"> </div>
                <p class="lead mt-2 fs-rem-110 fs-rem-lg-125">{{ recipe.teaser }}</p>
                <div class="d-flex justify-content-end align-items-baseline mt-auto brand-green">
                    <!-- Need improved accessibility -->
                    <p class="m-0"></p>
                    <button id="favouriting-btn" class="icon-button">
                        <i
                            class="fa{% if is_favourite %} fa-solid {% else %} fa-regular {% endif %} fa-heart mx-1 fs-rem-250 brand-green"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="bg-brand-green h-line mx-auto mt-3"> </div>
        <div class="bg-brand-green h-line mx-auto mt-1 mb-3"> </div>
        <div class="row">
            <div class="col-md-5 col-lg-4">
                <h2 class="fs-rem-130 fs-rem-lg-160">Ingredients:</h2>
                {{ recipe.ingredients | safe }}
                <div class="d-md-none bg-brand-green h-line mx-auto my-3"> </div>
            </div>
            <div class="col-md-7 col-lg-8 ps-md-3 recipe-instructions">
                <h2 class="fs-rem-130 fs-rem-lg-160">Instructions:</h2>
                {{ recipe.content | safe }}
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade bg-modal" id="sign-up-modal" role="dialog" tabindex="-1" aria-labelledby="sign-up-modal-label"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-body text-center position-relative p-4">
                <h1 class="modal-title fs-6 fw-normal" id="sign-up-modal-label">
                    You need to be signed in to favourite or rate recipes
                </h1>
                <button type="button" class="btn-close position-absolute top-0 end-0 mt-2 me-2" id="close-modal-btn"
                    aria-label="Close"></button>
                <p class="fs-5 fw-bold mt-2">
                    As a signed in user your can save recipes to your favourites, rate recipes, and post comments.
                </p>
                <p>Sign in or sign up for a <span class="fw-bold">free</span> account!</p>
                <div class="d-flex justify-content-center">
                    <a class="btn fave-signin-btn d-inline-block me-2" href="{% url 'account_login' %}"
                        aria-label="Go to the sign in page to log in">
                        Sign In
                    </a>
                    <a class="btn fave-signup-btn d-inline-block ms-2" href="{% url 'account_signup' %}"
                        aria-label="Go to the sign up page to register">
                        Sign Up
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block customscript %}
<script type="text/javascript">
    // Convert Django variables to JavaScript variables
    const recipeId = '{{ recipe.id | safe }}';
    const userId = '{{ user.id | safe }}';
</script>
<script type="text/javascript" src="{% static 'js/script.js' %}">
</script>
{% endblock customscript %}