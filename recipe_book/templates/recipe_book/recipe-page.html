{% extends "base.html" %}
{% load static %}

{% block token %}
<meta name="csrf-token" content="{{ csrf_token }}">
{% endblock token %}

{% block content %}
<div class="container-xl g-0">
    <div class="m-3 my-md-4 m-lg-4 p-4 bg-white recipe-container">
        <div class="row">
            <div class="img-container d-flex col-md-7">
                {% if "placeholder" in recipe.feature_image.url %}
                <img class="img-cover" src="{% static 'images/default-image.webp' %}" alt="placeholder image">
                {% else %}
                <img class="img-cover" src="{{ recipe.feature_image.url }}" alt="{{ recipe.alt_text }}">
                {% endif %}
            </div>
            <div class="col-md-5 mt-2 mt-md-0 d-flex flex-column">
                <div class="row d-flex justify-content-between">
                    <div class="col-auto fs-rem-150">X X X X X (123)</div>
                    <div class="col-auto fs-rem-150 brand-brown">
                        {% if recipe.category == 1 %}
                        <i class="fa-solid fa-drumstick-bite"></i>
                        {% elif recipe.category == 2 %}
                        <i class="fa-solid fa-bacon"></i>
                        {% elif recipe.category == 3 %}
                        <i class="fa-solid fa-cow"></i>
                        {% elif recipe.category == 4 %}
                        <i class="fa-solid fa-fish"></i>
                        {% elif recipe.category == 5 %}
                        <i class="fa-brands fa-pagelines"></i>
                        {% endif %}
                    </div>
                </div>
                <h1 class="fs-rem-130 fs-rem-lg-180 mt-2">{{ recipe.title }}</h1>
                <div class="bg-brand-green h-line"> </div>
                <p class="lead mt-2 fs-rem-110 fs-rem-lg-125">{{ recipe.teaser }}</p>
                <div class="d-flex justify-content-end align-items-baseline mt-auto brand-green">
                    <!-- Need improved accessibility -->
                    <p class="m-0"></p>
                    <button id="favouriting-btn" class="icon-button icon-button-stroke">
                        <i
                            class="fa{% if is_favourite %} fa-solid {% else %} fa-regular {% endif %} fa-heart mx-1 fs-rem-250"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="bg-brand-green h-line mx-auto mt-3"> </div>
        <div class="bg-brand-green h-line mx-auto mt-1 mb-3"> </div>
        <div class="row">
            <div class="col-md-5 col-lg-4">
                <h2 class="fs-rem-130 fs-rem-lg-160">Ingredients:</h2>
                {{ recipe.ingredients | safe }}
                <div class="d-md-none bg-brand-green h-line mx-auto my-3"> </div>
            </div>
            <div class="col-md-7 col-lg-8 ps-md-3 recipe-instructions">
                <h2 class="fs-rem-130 fs-rem-lg-160">Instructions:</h2>
                {{ recipe.content | safe }}
            </div>
        </div>
        <div class="bg-brand-green h-line mx-auto mt-3"> </div>
        <div class="bg-brand-green h-line mx-auto mt-1 mb-3"> </div>
        <section>
            {% if no_of_comments is not 0 %}
            <h3 class="fs-rem-130 fs-rem-lg-160">{{ no_of_comments }} comment{% if no_of_comments > 1 %}s{% endif %}
            </h3>
            {% else %}
            <h3 class="fs-rem-130 fs-rem-lg-160">This recipe has recived no comments yet.</h3>
            {% endif %}

            {% for comment in comments %}
            {% if comment.approved or comment.author == user %}
            <div class="bg-brand-green h-line mx-auto my-3 d-none d-md-block"> </div>
            <div class="row mx-auto my-2 py-3 bg-brand-gray {% if not comment.approved %}comment-inactive{% endif %}">
                <div class="col-12 col-md-3">
                    <p class="mb-0">
                        On {{ comment.created_on|date:"Y-m-d" }}
                        <span class="fw-bold">{% if comment.author == user %}you {% else %}{{ comment.author }}
                            {% endif %}</span> said:
                    </p>
                    <div class="bg-brand-green h-line d-md-none"> </div>
                    {% if not comment.approved %}
                    <br>
                    <p class="small">This comment has been <strong>disapproved</strong>. It is not visible to other
                        users.</p>
                    {% endif %}
                </div>
                <div class="col-12 col-md-9 mt-2 mt-md-0 comment-body d-flex flex-column justify-content-between">
                    <p class="text-break fst-italic fs-small">{{ comment.body }}</p>
                    <div>
                        <button class="py-1 px-2 comment-edit me-1" aria-label="Edit comment">
                            Edit
                        </button>
                        <button class="py-1 px-2 comment-delete  mx-1" aria-label="Edit comment">
                            Delete
                        </button>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </section>
    </div>
</div>

{% endblock content %}

{% block modal %}
{% include 'signupmodal.html' %}
{% endblock modal %}

{% block customscript %}
<script type="text/javascript">
    // Convert Django variables to JavaScript variables
    const recipeId = '{{ recipe.id | safe }}';
    const userId = '{{ user.id | safe }}';
</script>
<script type="text/javascript" src="{% static 'js/script.js' %}">
</script>
{% endblock customscript %}